{"version":3,"file":"bundle.min.js","sources":["../src/utils.ts","../src/provider.ts"],"sourcesContent":["declare global {\n    interface Window { opera: any; }\n}\n\nexport function isMobile() {\n    var check = false;\n    (function (a) { if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true; })(navigator.userAgent || navigator.vendor || window.opera);\n    return check;\n}\n","import { Payload, Network } from \"./types\";\nimport { isMobile } from \"./utils\";\n\nconst sdkVersion = '1.2.0';\nconst postMessages = {\n    PT_RESPONSE: 'PT_RESPONSE',\n    PT_HANDLE_REQUEST: 'PT_HANDLE_REQUEST',\n    PT_AUTHENTICATED: 'PT_AUTHENTICATED',\n    PT_SHOW_IFRAME: 'PT_SHOW_IFRAME',\n    PT_HIDE_IFRAME: 'PT_HIDE_IFRAME',\n    PT_USER_DENIED: 'PT_USER_DENIED',\n}\n\nexport class PortisProvider {\n    portisClient = 'https://app.portis.io';\n    requests: { [id: string]: { payload: Payload, cb } } = {};\n    queue: { payload: Payload, cb }[] = [];\n    iframe: Promise<HTMLIFrameElement>;\n    authenticated = false;\n    account: string | null = null;\n    network: string | null = null;\n    isPortis = true;\n    referrerAppOptions;\n\n    constructor(opts: { apiKey: string, network?: Network }) {\n        if (!opts.apiKey) {\n            throw 'apiKey is missing. Please check your apiKey in the Portis dashboard: https://app.portis.io/dashboard';\n        }\n\n        this.referrerAppOptions = {\n            sdkVersion,\n            network: opts.network || 'mainnet',\n            apiKey: opts.apiKey,\n        };\n        this.iframe = this.createIframe();\n        this.listen();\n    }\n\n    sendAsync(payload: Payload, cb) {\n        this.enqueue(payload, cb);\n    }\n\n    send(payload: Payload) {\n        let result;\n\n        switch (payload.method) {\n\n            case 'eth_accounts':\n                const account = this.account;\n                result = account ? [account] : [];\n                break;\n\n            case 'eth_coinbase':\n                result = this.account;\n                break;\n\n            case 'net_version':\n                result = this.network;\n                break;\n\n            case 'eth_uninstallFilter':\n                this.sendAsync(payload, (_) => _);\n                result = true;\n                break;\n\n            default:\n                throw new Error(`The Portis Web3 object does not support synchronous methods like ${payload.method} without a callback parameter.`);\n        }\n\n        return {\n            id: payload.id,\n            jsonrpc: payload.jsonrpc,\n            result: result,\n        }\n    }\n\n    isConnected() {\n        return true;\n    }\n\n    private createIframe(): Promise<HTMLIFrameElement> {\n        return new Promise((resolve, reject) => {\n            window.addEventListener('load', () => {\n                const iframe = document.createElement('iframe');\n                const iframeStyleProps = {\n                    'display': 'none',\n                    'position': 'fixed',\n                    'top': '10px',\n                    'right': '20px',\n                    'height': '525px',\n                    'width': '390px',\n                    'z-index': '2147483647',\n                    'box-shadow': '0 5px 40px rgba(0,0,0,.16)',\n                    'border-radius': '8px',\n                    'border': 'none',\n                    'animation': 'portis-entrance 250ms ease-in-out forwards',\n                    'opacity': '0',\n                };\n                const iframeMobileStyleProps = {\n                    'display': 'none',\n                    'position': 'fixed',\n                    'z-index': '2147483647',\n                    'width': '100%',\n                    'height': '100%',\n                    'top': '0',\n                    'left': '0',\n                    'right': '0',\n                    'border': 'none',\n                };\n                const style = document.createElement('style');\n                style.innerHTML = '@keyframes portis-entrance { 100% { opacity: 1; top: 20px; } }';\n\n                if (isMobile()) {\n                    Object.keys(iframeMobileStyleProps).forEach((prop: any) => iframe.style[prop] = (iframeMobileStyleProps as any)[prop]);\n                } else {\n                    Object.keys(iframeStyleProps).forEach((prop: any) => iframe.style[prop] = (iframeStyleProps as any)[prop]);\n                }\n\n                iframe.scrolling = 'no';\n                iframe.id = 'PT_IFRAME';\n                iframe.src = `${this.portisClient}/send/?p=${btoa(JSON.stringify(this.referrerAppOptions))}`;\n                document.body.appendChild(iframe);\n                document.head.appendChild(style);\n                resolve(iframe);\n            }, false);\n        });\n    }\n\n    private showIframe() {\n        this.iframe.then(iframe => {\n            iframe.style.display = 'block'\n\n            if (isMobile()) {\n                document.body.style.overflow = 'hidden';\n            }\n        });\n    }\n\n    private hideIframe() {\n        this.iframe.then(iframe => {\n            iframe.style.display = 'none';\n\n            if (isMobile()) {\n                document.body.style.overflow = 'inherit';\n            }\n        });\n    }\n\n    private enqueue(payload: Payload, cb) {\n        this.queue.push({ payload, cb });\n\n        if (this.authenticated) {\n            this.dequeue();\n        } else if (this.queue.length == 1) {\n            // show iframe in order to authenticate the user\n            this.showIframe();\n        }\n    }\n\n    private dequeue() {\n        if (this.queue.length == 0) {\n            return;\n        }\n\n        const item = this.queue.shift();\n\n        if (item) {\n            const payload = item.payload;\n            const cb = item.cb;\n            this.sendPostMessage(postMessages.PT_HANDLE_REQUEST, payload);\n            this.requests[payload.id] = { payload, cb };\n            this.dequeue();\n        }\n    }\n\n    private sendPostMessage(msgType: string, payload?: Object) {\n        this.iframe.then(iframe => {\n            if (iframe.contentWindow) {\n                iframe.contentWindow.postMessage({ msgType, payload }, '*');\n            }\n        });\n    }\n\n    private listen() {\n        window.addEventListener('message', (evt) => {\n            if (evt.origin === this.portisClient) {\n                switch (evt.data.msgType) {\n\n                    case postMessages.PT_AUTHENTICATED: {\n                        this.authenticated = true;\n                        this.dequeue();\n                        break;\n                    }\n\n                    case postMessages.PT_RESPONSE: {\n                        const id = evt.data.response.id;\n                        this.requests[id].cb(null, evt.data.response);\n\n                        if (this.requests[id].payload.method === 'eth_accounts' || this.requests[id].payload.method === 'eth_coinbase') {\n                            this.account = evt.data.response.result[0];\n                        }\n\n                        if (this.requests[id].payload.method === 'net_version') {\n                            this.network = evt.data.response.result;\n                        }\n\n                        this.dequeue();\n                        break;\n                    }\n\n                    case postMessages.PT_SHOW_IFRAME: {\n                        this.showIframe();\n                        break;\n                    }\n\n                    case postMessages.PT_HIDE_IFRAME: {\n                        this.hideIframe();\n                        break;\n                    }\n\n                    case postMessages.PT_USER_DENIED: {\n                        const id = evt.data.response ? evt.data.response.id : null;\n\n                        if (id) {\n                            this.requests[id].cb(new Error('User denied transaction signature.'));\n                        } else {\n                            this.queue.forEach(item => item.cb(new Error('User denied transaction signature.')));\n                        }\n\n                        this.dequeue();\n                        break;\n                    }\n                }\n            }\n        }, false);\n    }\n}\n"],"names":["a","check","navigator","userAgent","vendor","window","opera","test","substr","postMessages","opts","this","apiKey","referrerAppOptions","sdkVersion","network","iframe","createIframe","listen","PortisProvider","payload","cb","enqueue","result","method","account","sendAsync","_","Error","id","jsonrpc","Promise","resolve","reject","addEventListener","document","createElement","iframeStyleProps","display","position","top","right","height","width","z-index","box-shadow","border-radius","border","animation","opacity","iframeMobileStyleProps","left","style","innerHTML","isMobile","Object","keys","forEach","prop","scrolling","src","_this","portisClient","btoa","JSON","stringify","body","appendChild","head","then","overflow","queue","push","authenticated","dequeue","length","showIframe","item","shift","sendPostMessage","requests","msgType","contentWindow","postMessage","evt","origin","data","response","hideIframe"],"mappings":"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"}